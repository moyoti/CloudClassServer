<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>

    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        #file {
        }
        .checkboxes{
            margin:10px;
        }
    </style>
    <script>
        var uploadList;
        $(function () {
            $.ajax({
                type: "POST",
                url: "/course/getcreatecoursepc",
                data: {t: 1},
                success: function (re) {
                    for (var i=0;i<re.length;i++) {
                        document.getElementById("checkboxgroup").innerHTML += "<div><label>\n" +
                            "        <input class=\"checkboxes\" type=\"checkbox\" value=\"" + re[i].course.cid + "\">"+re[i].course.cname+"\n" +
                            "    </label></div>"
                    }
                }
            });
        });
        function saveclass() {
            var checkboxes=$(".checkboxes");
            uploadList=new Array();
            for (var i=0;i<checkboxes.length;i++){
                if (checkboxes[i].checked){
                    uploadList.push(checkboxes[i].getAttribute("value"));
                }
            }

            for (var i=0;i<checkboxes.length;i++){
                checkboxes[i].disabled=true;
            }

        }
        function editclass() {
            var checkboxes=$(".checkboxes");
            for (var i=0;i<checkboxes.length;i++){
                checkboxes[i].disabled=false;
            }
        }
        $(function () {
            $("#btn").on('click', function () {
            });
            $("#file").change(function () {
                $("#progress-bar").css("width", 0);
            });
        });

        function UploadFile() {
            if(uploadList===undefined||uploadList.length===0){
                alert("请先选择班级");
                return;
            }
            var xhrOnProgress = function (fun) {
                xhrOnProgress.onprogress = fun; //绑定监听
                //使用闭包实现监听绑
                return function () {
                    //通过$.ajaxSettings.xhr();获得XMLHttpRequest对象
                    var xhr = $.ajaxSettings.xhr();
                    //判断监听函数是否为函数
                    if (typeof xhrOnProgress.onprogress !== 'function')
                        return xhr;
                    //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去
                    if (xhrOnProgress.onprogress && xhr.upload) {
                        xhr.upload.onprogress = xhrOnProgress.onprogress;
                    }
                    return xhr;
                }
            };
            var file = $("#file")[0].files;
//            var videotitle=$("#videoname").val();
//            var picfile = $("#picfile")[0].files[0];
//            var videocontent=$("#videoContent").val();
            var form = new FormData();
            for (var i = 0; i < file.length; i++) {
                form.append('files', file[i]);
            }
            form.append("cid",uploadList);
//            form.append('title',videotitle);
//            form.append('picfile',picfile);
//            form.append('content',videocontent);
            form.append("csrfmiddlewaretoken", '{{ csrf_token }}');

            $.ajax({
                type: 'POST',
                url: '/resource/uploadfile',
                data: form,
                processData: false,  // 告诉jquery不转换数据
                contentType: false,  // 告诉jquery不设置内容格式
                xhr: xhrOnProgress(function (e) {
//                    var percent = e.loaded / e.total;
//                    $("#progress-bar").css("width", (percent * 500));
//                    document.getElementById("sr-only").innerText=parseInt((percent*100).toString())+"%";
                }),
                success: function (arg) {
                    console.log(arg);
                }
            })
        }

        function logout() {
            $.ajax({
                type: 'POST',
                url: '/users/logoutpc',
                success: function (arg) {
                    alert("登出成功");
                }
            })
        }

    </script>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <!--<div class="navbar-header">-->
        <!--<a href="#" class="navbar-brand">你好，吴玠璘</a>-->
        <!--</div>-->
        <!--<div id="navbar" class="collapse navbar-collapse navbar-right">-->
        <!--<ul class="nav navbar-nav">-->
        <!--<li ><a href="login.html" onclick="logout()">登出</a></li>-->
        <!--</ul>-->
        <!--</div>-->
    </div>
</nav>
<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="#" class="navbar-brand">Cloud Class File Upload</a>
        </div>
    </div>
</nav>
<div id="checkboxgroup" class="checkbox-inline" style="padding-top: 10%;margin: 10px;">

</div>
<button onclick="editclass()">edit</button>
<button onclick="saveclass()">save</button>
<div class="container" style="margin-top: 100px">
    <div class="row">
        <div class="col-md-5 col-md-offset-2">
            <!--<form action="/resource/uploadfile" enctype="multipart/form-data" method="POST">-->
            <!--<label>视频标题：</label>-->
            <!--<input type="text" id="videoname"><br/>-->
            <!--<label>视频简介：</label>-->
            <!--<textarea id="videoContent" class="form-control" rows="4" placeholder=""-->
            <!--style="resize: none;"></textarea>-->
            <!--<label>视频缩略图：</label>-->
            <!--<input type="file" id="picfile" style=""/>-->
            <label>上传文件：</label>
            <input type="file" id="file" multiple style=""/>
            <button onclick="UploadFile()">上传</button>
            <!--</form>-->
            <div class="progress" style="width: 500px">
                <div id="progress-bar" class="progress-bar progress-bar-success progress-bar-striped" role="progressbar"
                     aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                    <span id="sr-only" style="z-index: 10"></span>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>